<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Abhaya+Libre:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/public/styles/settings.css">
    <link rel="stylesheet" type="text/css" href="/public/styles/modal.css">
    <title>Account</title>
</head>
<body>
    <?php $isAdmin = (($_SESSION['role'] ?? '') === 'admin'); ?>
    <header class="header">
        <div class="tittle">
            Purrfect Care
        </div>
        <nav class="option-bar">
            <ul>
                <div data-user-username>user1</div>
                <img src="/public/img/avatar.jpg" class="small-avatar" data-user-avatar>
                <?php if (!isset($isAdmin) || !$isAdmin): ?>
                    <li data-user-only hidden><a href="#"><i class="fa-solid fa-bell"></i></a></li>
                <?php endif; ?>
                <li><a href="/logout"><i class="fa-solid fa-right-from-bracket"></i></a></li>
            </ul>
        </nav>
    </header>
    
    <main class="main-content">
        <div class="box_top">
            <div>Account</div>
            <div class="options">
                <a class="single-option" href="/dashboard" data-settings-back>
                    <i class="fa-solid fa-arrow-left"></i>
                    Back
                </a>
            </div>
        </div>

        <?php
            $ok = isset($_GET['ok']) ? (string)$_GET['ok'] : '';
            $err = isset($_GET['err']) ? (string)$_GET['err'] : '';

            $flash = '';
            if ($ok === 'account') $flash = 'Zapisano zmiany konta.';
            if ($ok === 'profile') $flash = 'Zapisano dane profilu.';
            if ($ok === 'pw') $flash = 'Zmieniono hasło.';

            if ($err === 'profile') $flash = 'Uzupełnij imię i nazwisko.';
            if ($err === 'pw') $flash = 'Wpisz stare i nowe hasło.';
            if ($err === 'pw_old') $flash = 'Stare hasło jest nieprawidłowe.';
            if ($err === 'avatar') $flash = 'Nie udało się wgrać zdjęcia (format JPG/PNG/WEBP, max 5MB).';
            if ($err === 'account') $flash = 'Nie udało się zapisać zmian. Spróbuj ponownie.';
        ?>
        <?php if ($flash !== ''): ?>
            <div class="section-box">
                <div class="box_middle">
                    <div class="pc-info">
                        <div class="pc-info-row">
                            <div class="pc-info-key">Info</div>
                            <div class="pc-info-val"><?php echo htmlspecialchars($flash, ENT_QUOTES, 'UTF-8'); ?></div>
                        </div>
                    </div>
                </div>
            </div>
        <?php endif; ?>

        <div class="section-box">
            <div class="box_middle">
                <div class="pc-section-header">
                    <div class="section-tittle">Account</div>
                    <button class="pc-action-btn" type="button" data-modal-open="account-edit">Edit</button>
                </div>
                <div class="section-subtitle">Name, password, profile photo</div>

                <div class="profile-grid">
                    <div class="profile-row">
                        <div class="profile-key">Username</div>
                        <div class="profile-val" data-profile-username>—</div>
                    </div>
                    <div class="profile-row">
                        <div class="profile-key">Full name</div>
                        <div class="profile-val" data-profile-fullname>—</div>
                    </div>
                    <div class="profile-row">
                        <div class="profile-key">Email</div>
                        <div class="profile-val" data-profile-email>—</div>
                    </div>
                    <div class="profile-row">
                        <div class="profile-key">Role</div>
                        <div class="profile-val" data-profile-role>—</div>
                    </div>
                </div>
            </div>
        </div>

        <?php if (!$isAdmin): ?>
        <div class="section-box" data-user-only hidden>
            <div class="box_middle">
                <div class="pc-section-header">
                    <div class="section-tittle">My cats</div>
                </div>
                <div class="section-subtitle">You can manage your cats here</div>
                <div class="all-users" data-settings-cats></div>
            </div>
        </div>
        <?php endif; ?>
        <div class="section-box">
            <div class="box_bottom">
                <div class="section-tittle">
                    Application settings
                </div>
                <div class="section-subtitle">You can manage application settings here</div>
                <div class="settings-options">
                    <div class="settings-left">
                        <div class="setting-tittle">Basic settings</div>
                        <label>
                            xd
                            <input type="checkbox" name="setting-checkbox" value="yes">
                        </label>
                        <label>
                            halo khartus??
                            <input type="checkbox" name="setting-checkbox" value="yes">
                        </label>
                        <label>
                            nie wiem co tu sie robi many
                            <input type="checkbox" name="setting-checkbox" value="yes">
                        </label>
                    </div>
                    <div class="settings-right">
                        <div class="setting-tittle">Basic settings</div>
                        <label>
                            xd
                            <input type="checkbox" name="setting-checkbox" value="yes">
                        </label>
                    </div>
                    <div class="settings-empty">
                    </div>
                </div>
            </div>
        </div>
        <?php if (!$isAdmin): ?>
        <div class="box_under_bottom" data-user-only hidden>
            <div class="logout-mobile">Log out</div>
        </div>
        <?php endif; ?>
    </main>

    <?php if (!$isAdmin): ?>
    <footer class="footer" data-user-only hidden>
        <nav class="menu-bar" >
        <ul>
            <li><a href="/dashboard"><i class="fa-solid fa-house"></i>Home</a></li>
            <li><a href="/cats"><i class="fa-solid fa-cat"></i>Cats</a></li>
            <li><a href="/schedule"><i class="fa-solid fa-calendar"></i> Schedule</a></li>
            <li><a href="/logs"><i class="fa-solid fa-bars"></i>Logs</a></li>
            <li><a href="/settings"><i class="fa-solid fa-gear"></i>Account</a></li>
        </ul>
    </nav>
    </footer>
    <?php endif; ?>

    <template id="tpl-settings-cat-row">
        <div class="single-user">
            <img src="/public/img/avatar.jpg" class="user-avatar" data-settings-cat-avatar>
            <div class="user-description">
                <div>
                    <div class="user-name" data-settings-cat-name>—</div>
                    <div class="pc-cat-meta" data-settings-cat-meta hidden></div>
                </div>
                <div class="user-icons">
                    <form class="pc-inline-form" method="POST" data-cat-delete data-settings-cat-delete>
                        <input type="hidden" name="cat_id" value="" data-settings-cat-id-field />
                        <button class="pc-icon-link" type="submit" aria-label="Delete">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    </form>
                    <a href="/details" aria-label="Edit" data-settings-cat-edit>
                        <i class="fa-solid fa-pen"></i>
                    </a>
                </div>
            </div>
        </div>
    </template>

    <template id="tpl-account-edit">
        <form class="pc-form" data-modal-form method="POST" action="/account-update" enctype="multipart/form-data" id="pc-modal-form">
            <div class="pc-field">
                <label>Username (not changeable)</label>
                <input class="pc-input" type="text" data-account-username readonly />
            </div>

            <div class="pc-grid-2">
                <div class="pc-field">
                    <label>First name</label>
                    <input class="pc-input" name="first_name" type="text" />
                </div>
                <div class="pc-field">
                    <label>Last name</label>
                    <input class="pc-input" name="last_name" type="text" />
                </div>
            </div>

            <div class="pc-field">
                <label>Old password</label>
                <input class="pc-input" name="old_password" type="password" placeholder="••••••••" />
            </div>
            <div class="pc-field">
                <label>New password</label>
                <input class="pc-input" name="new_password" type="password" placeholder="••••••••" />
            </div>

            <div class="pc-field">
                <label>Profile photo</label>
                <input class="pc-input" name="avatar" type="file" accept="image/png,image/jpeg,image/webp" />
            </div>
        </form>
    </template>

    <template id="tpl-cat-form">
        <form class="pc-form" data-modal-form enctype="multipart/form-data">
            <input type="hidden" name="cat_id" value="" />
            <div class="pc-field">
                <label>Name</label>
                <input class="pc-input" name="name" type="text" required />
            </div>
            <div class="pc-grid-2">
                <div class="pc-field">
                    <label>Age</label>
                    <input class="pc-input" name="age" type="number" min="0" />
                </div>
                <div class="pc-field">
                    <label>Breed</label>
                    <input class="pc-input" name="breed" type="text" />
                </div>
            </div>
            <div class="pc-field">
                <label>Description</label>
                <textarea class="pc-textarea" name="description" placeholder="Short note..."></textarea>
            </div>
            <div class="pc-field">
                <label>Photo</label>
                <input class="pc-input" name="avatar" type="file" accept="image/png,image/jpeg,image/webp" />
            </div>
        </form>
    </template>

    <div class="pc-modal-overlay" data-modal-overlay hidden>
        <div class="pc-modal" role="dialog" aria-modal="true" aria-labelledby="pc-modal-title">
            <div class="pc-modal-header">
                <div class="pc-modal-title" id="pc-modal-title" data-modal-title>Modal</div>
                <button class="pc-modal-close" type="button" aria-label="Close" data-modal-close>&times;</button>
            </div>
            <div class="pc-modal-body" data-modal-body></div>
            <div class="pc-modal-footer">
                <button class="pc-btn pc-btn-secondary" type="button" data-modal-cancel>Cancel</button>
                <button class="pc-btn pc-btn-primary" type="button" data-modal-ok>OK</button>
            </div>
        </div>
    </div>
    <script defer src="/public/scripts/main.js"></script>
</body>
</html>
